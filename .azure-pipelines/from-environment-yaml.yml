jobs:
- job:
  displayName: 'environment.yml'
  pool:
    vmImage: 'ubuntu-16.04'

  steps:
  - bash: echo "##vso[task.prependpath]/usr/share/miniconda/bin"
    displayName: Add conda to PATH

  - script: conda env create --quiet --file environment.yml
    displayName: Create Anaconda environment

  - bash: |
      source activate env-from-yaml
      pytest --junitxml=junit/unit-test.xml
    displayName: pytest

  - task: PublishTestResults@2
    inputs:
      testResultsFiles: 'junit/*.xml'
      testRunTitle: 'Python $(python.version)'
    condition: succeededOrFailed()
